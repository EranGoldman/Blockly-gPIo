<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly gPIo</title>
  <script src="blockly/blockly_compressed.js"></script>
  <script src="blockly/blocks_compressed.js"></script>
  <script src="blockly/javascript_compressed.js"></script>
  <script src="blockly/python_compressed.js"></script>
  <script src="js/libs/acorn_interpreter.js"></script>
  <script src="js/gpio_blocks.js"></script>
  <script src="js/time_blocks.js"></script>
  <script src="blockly/msg/js/en.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>

<body>
  <h1>Blockly gPIo</h1>
  <p>Simple proof of concept for Blockly to generate Python gpio code and javascript to simulate gpios on browser.</p>
  <p>
    <button onclick="Bgpio.runMode.changeMode()">Change mode</button> Mode: <span id="modeName">Simulation</span>
  </p>
  <p>
    <button id="debugInitButton" onclick="Bgpio.runMode.debugInit()">Debug Code</button>
    <button id="debugStepButton" onclick="Bgpio.runMode.debugStep()" disabled="disabled">Debug Step</button>
    <button id="runButton" onclick="Bgpio.runMode.run()">Run</button>
    <button id="stopButton" onclick="Bgpio.runMode.stop()" disabled="disabled">Stop</button>
  </p>

  <div id="blocklyDiv" style="height: 480px; width: 50%; float: left"></div>
  <div id="simulationContentDiv" style="height: 480px; width: 49%; float: left; display: block">
    <div id="pinsDiv" style="height: 350px;">
      <!-- Table extracted and modified from https://projects.drogon.net/raspberry-pi/wiringpi/pins/ -->
      <table style="width: 450px;">
        <tbody>
          <tr>
              <th style="text-align: center;">BCM</th>
              <th style="text-align: center;">Name</th>
              <th style="text-align: center;" colspan="2">Header</th>
              <th style="text-align: center;">Name</th>
              <th style="text-align: center;">BCM</th>
          </tr>
          <tr>
              <td style="text-align: center;">-</td>
              <td style="text-align: center;"><span style="color: #ff0000;">3.3v</span></td>
              <th style="text-align: center;">1</th>
              <th style="text-align: center;">2</th>
              <td style="text-align: center;" align="center"><span style="color: #ff6600;">5v</span></td>
              <td style="text-align: center;" align="center">-</td>
          </tr>
          <tr>
              <td style="text-align: center;">R1:0/R2:2</td>
              <td style="text-align: center;"><span style="color: #33cccc;">SDA</span></td>
              <th style="text-align: center;">3</th>
              <th style="text-align: center;">4</th>
              <td style="text-align: center;"><span style="color: #ff6600;">5v</span></td>
              <td style="text-align: center;">-</td>
          </tr>
          <tr>
              <td style="text-align: center;">R1:1/R2:3</td>
              <td style="text-align: center;"><span style="color: #33cccc;">SCL</span></td>
              <th style="text-align: center;">5</th>
              <th style="text-align: center;">6</th>
              <td style="text-align: center;"><span style="color: #000000;">0v</span></td>
              <td style="text-align: center;">-</td>
          </tr>
          <tr>
              <td style="text-align: center;">4</td>
              <td style="text-align: center;"><span style="color: #008000;">GPIO7</span></td>
              <th style="text-align: center;">7</th>
              <th style="text-align: center;">8</th>
              <td style="text-align: center;"><span style="color: #ffff00;">TxD</span></td>
              <td style="text-align: center;">14</td>
          </tr>
          <tr>
              <td style="text-align: center;">-</td>
              <td style="text-align: center;"><span style="color: #000000;">0v</span></td>
              <th style="text-align: center;">9</th>
              <th style="text-align: center;">10</th>
              <td style="text-align: center;"><span style="color: #ffff00;">RxD</span></td>
              <td style="text-align: center;">15</td>
          </tr>
          <tr>
              <td style="text-align: center;">0</td>
              <td style="text-align: center;"><span style="color: #008000;">GPIO0</span></td>
              <th style="text-align: center;">11</th>
              <th style="text-align: center;">12</th>
              <td style="text-align: center;"><span style="color: #008000;">GPIO1</span></td>
              <td style="text-align: center;">18</td>
          </tr>
          <tr>
              <td style="text-align: center;">R1:21/R2:27</td>
              <td style="text-align: center;"><span style="color: #008000;">GPIO2</span></td>
              <th style="text-align: center;">13</th>
              <th style="text-align: center;">14</th>
              <td style="text-align: center;"><span style="color: #000000;">0v</span></td>
              <td style="text-align: center;">-</td>
          </tr>
          <tr>
              <td style="text-align: center;">22</td>
              <td style="text-align: center;"><span style="color: #008000;">GPIO3</span></td>
              <th style="text-align: center;">15</th>
              <th style="text-align: center;">16</th>
              <td style="text-align: center;"><span style="color: #008000;">GPIO4</span></td>
              <td style="text-align: center;">23</td>
          </tr>
          <tr>
              <td style="text-align: center;">-</td>
              <td style="text-align: center;"><span style="color: #ff0000;">3.3v</span></td>
              <th style="text-align: center;">17</th>
              <th style="text-align: center;">18</th>
              <td style="text-align: center;"><span style="color: #008000;">GPIO5</span></td>
              <td style="text-align: center;">24</td>
          </tr>
          <tr>
              <td style="text-align: center;">10</td>
              <td style="text-align: center;"><span style="color: #800080;">MOSI</span></td>
              <th style="text-align: center;">19</th>
              <th style="text-align: center;">20</th>
              <td style="text-align: center;"><span style="color: #000000;">0v</span></td>
              <td style="text-align: center;">-</td>
          </tr>
          <tr>
              <td style="text-align: center;">9</td>
              <td style="text-align: center;"><span style="color: #800080;">MISO</span></td>
              <th style="text-align: center;">21</th>
              <th style="text-align: center;">22</th>
              <td style="text-align: center;"><span style="color: #008000;">GPIO6</span></td>
              <td style="text-align: center;">25</td>
          </tr>
          <tr>
              <td style="text-align: center;">11</td>
              <td style="text-align: center;"><span style="color: #800080;">SCLK</span></td>
              <th style="text-align: center;">23</th>
              <th style="text-align: center;">24</th>
              <td style="text-align: center;"><span style="color: #800080;">CE0</span></td>
              <td style="text-align: center;">8</td>
          </tr>
          <tr>
              <td style="text-align: center;">-</td>
              <td style="text-align: center;"><span style="color: #000000;">0v</span></td>
              <th style="text-align: center;">25</th>
              <th style="text-align: center;">26</th>
              <td style="text-align: center;"><span style="color: #800080;">CE1</span></td>
              <td style="text-align: center;">7</td>
          </tr>
          <tr>
              <th style="text-align: center;">BCM</th>
              <th style="text-align: center;">Name</th>
              <th style="text-align: center;" colspan="2">Header</th>
              <th style="text-align: center;">Name</th>
              <th style="text-align: center;">BCM</th>
          </tr>
        </tbody>
      </table>
    </div>
    <div id="jsConsoleDiv" style="height: 130px; overflow: auto;background-color: black; color: white">
      <pre style="margin:0; padding:0;">Javascript simulated output console goes here.</pre>
    </div>
  </div>
  <div id="executionContentDiv" style="height: 480px; width: 49%; float: left; display: none;">
    <div id="pythonCodeDiv" style="height: 350px; overflow: auto;">
      <pre id="pythonCodePre" style="margin: 0; padding: 0;">Python code goes here.</pre>
    </div>
    <div id="pythonConsoleDiv" style="height: 130px; overflow: auto; background-color: black; color: white">
      <pre id="pythonConsolePre" style="margin:0; padding:0;">Python real console output goes here.</pre>
    </div>
  </div>

  <!-- Toolbox -->
  <xml id="toolbox" style="display: none">
    <category name="Logic">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
    </category>
    <category name="Loops">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <block type="math_number">
            <field name="NUM">10</field>
          </block>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
    </category>
    <category name="Math">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
    </category>
    <category name="Text">
      <block type="text"></block>
      <block type="text_length"></block>
      <block type="text_print"></block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <block type="text"></block>
        </value>
      </block>
    </category>
    <category name="Variables" custom="VARIABLE"></category>
    <category name="Functions" custom="PROCEDURE"></category>
    <category name="gPIo">
      <block type="led_set"></block>
      <block type="pin_binary"></block>
    </category>
    <category name="time">
      <block type="sleep_ms"></block>
    </category>
  </xml>

  <!-- Blocks to display on the workspace -->
  <xml id="startBlocks" style="display: none">
    <block type="controls_repeat_ext" x="21" y="34">
        <value name="TIMES">
        <block type="math_number">
            <field name="NUM">2</field>
        </block>
        </value>
        <statement name="DO">
        <block type="led_set">
            <field name="PIN">1</field>
            <value name="STATE">
            <block type="pin_binary">
                <field name="STATE">HIGH</field>
            </block>
            </value>
            <next>
            <block type="sleep_ms">
                <value name="SLEEP_TIME_MILI">
                <block type="math_number">
                    <field name="NUM">750</field>
                </block>
                </value>
                <next>
                <block type="led_set">
                    <field name="PIN">1</field>
                    <value name="STATE">
                    <block type="pin_binary">
                        <field name="STATE">LOW</field>
                    </block>
                    </value>
                    <next>
                    <block type="sleep_ms">
                        <value name="SLEEP_TIME_MILI">
                        <block type="math_number">
                            <field name="NUM">1250</field>
                        </block>
                        </value>
                        <next>
                        <block type="led_set">
                            <field name="PIN">2</field>
                            <value name="STATE">
                            <block type="pin_binary">
                                <field name="STATE">HIGH</field>
                            </block>
                            </value>
                            <next>
                            <block type="sleep_ms">
                                <value name="SLEEP_TIME_MILI">
                                <block type="math_number">
                                    <field name="NUM">1000</field>
                                </block>
                                </value>
                                <next>
                                <block type="led_set">
                                    <field name="PIN">2</field>
                                    <value name="STATE">
                                    <block type="pin_binary">
                                        <field name="STATE">LOW</field>
                                    </block>
                                    </value>
                                    <next>
                                    <block type="sleep_ms">
                                        <value name="SLEEP_TIME_MILI">
                                        <block type="math_number">
                                            <field name="NUM">500</field>
                                        </block>
                                        </value>
                                    </block>
                                    </next>
                                </block>
                                </next>
                            </block>
                            </next>
                        </block>
                        </next>
                    </block>
                    </next>
                </block>
                </next>
            </block>
            </next>
        </block>
        </statement>
    </block>
    </xml>

  <script src="js/js_interpreter.js"></script>
  <script src="js/python_interpreter.js"></script>
  <script src="js/app_logic.js"></script>
</body>
</html>
